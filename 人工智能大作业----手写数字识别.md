# 手写数字识别

## 数据集准备和预处理

前往 https://yann.lecun.com/exdb/mnist/ 下载需要的训练集、测试集数据和标签，并对数据进行预处理。

```python
def load_mnist_data(image_file, label_file):
    # 加载图像
    with gzip.open(image_file, 'rb') as f:
        magic, num, rows, cols = struct.unpack('>IIII', f.read(16))
        images = np.frombuffer(f.read(), dtype=np.uint8)
        images = images.reshape(num, rows * cols)
    # 加载标签
    with gzip.open(label_file, 'rb') as f:
        magic, num = struct.unpack('>II', f.read(8))
        labels = np.frombuffer(f.read(), dtype=np.uint8)
    return images, labels

# 加载数据
train_images, train_labels = load_mnist_data('train-images-idx3-ubyte.gz', 
                                           'train-labels-idx1-ubyte.gz')
test_images, test_labels = load_mnist_data('t10k-images-idx3-ubyte.gz', 
                                         't10k-labels-idx1-ubyte.gz')

# 数据预处理
scaler = StandardScaler()
X_train = scaler.fit_transform(train_images.astype('float32'))
X_test = scaler.transform(test_images.astype('float32'))
y_train = train_labels
y_test = test_labels
```

## KNN

### 训练模型

采用 sklearn 库的 KNN 算法来进行训练，代码如下：

```python
from sklearn.neighbors import KNeighborsClassifier

def knn_experiment(X_train, X_test, y_train, y_test, k_values):
    results = []
    for k in k_values:
        print(f"正在测试 k={k}...")
        knn = KNeighborsClassifier(n_neighbors=k)
        start_time = time.time()
        knn.fit(X_train, y_train)
        train_time = time.time() - start_time
        
        start_time = time.time()
        y_pred = knn.predict(X_test)
        test_time = time.time() - start_time
        
        accuracy = accuracy_score(y_test, y_pred)

        results.append({
            'k': k,
            'accuracy': accuracy,
            'train_time': train_time,
            'test_time': test_time
        })
    return results

# 测试不同的k值
k_values = [1, 3, 5, 7, 9]
knn_results = knn_experiment(X_train, X_test, y_train, y_test, k_values)
```

### 测试结果

使用 Matplotlib 绘制出实验结果，代码如下：

```python
# 设置中文字体，使用苹果电脑自带的字体
font = FontProperties(fname='/System/Library/Fonts/STHeiti Medium.ttc')

# KNN结果分析
def plot_knn_results(results):
    k_values = [r['k'] for r in results]
    accuracies = [r['accuracy'] for r in results]
    
    plt.figure(figsize=(10, 6))
    plt.plot(k_values, accuracies, 'bo-')
    plt.xlabel('K值', fontproperties=font)
    plt.ylabel('准确率', fontproperties=font)
    plt.title('KNN: K值与准确率的关系', fontproperties=font)
    plt.grid(True)
    plt.show()

plot_knn_results(knn_results)
```

实验结果如下：

![image-20241217164346973](https://ceyewan.oss-cn-beijing.aliyuncs.com/typora/image-20241217164346973.png)

##  全连接的神经网络

### 训练模型

```python
from sklearn.neural_network import MLPClassifier

def mlp_experiment(X_train, X_test, y_train, y_test, hidden_layers, learning_rates):
    results = []
    for hidden in hidden_layers:
        for lr in learning_rates:
            print(f"正在测试 hidden_layer={hidden}, learning_rate={lr}...")
            mlp = MLPClassifier(hidden_layer_sizes=hidden, 
                              learning_rate_init=lr,
                              max_iter=100)
            
            start_time = time.time()
            mlp.fit(X_train, y_train)
            train_time = time.time() - start_time
            
            start_time = time.time()
            y_pred = mlp.predict(X_test)
            test_time = time.time() - start_time
            
            accuracy = accuracy_score(y_test, y_pred)
            results.append({
                'hidden_layer': hidden,
                'learning_rate': lr,
                'accuracy': accuracy,
                'train_time': train_time,
                'test_time': test_time
            })
    return results

# 测试不同的隐层节点数和学习率
hidden_layers = [(500,), (1000,), (1500, ), (2000, )]
learning_rates = [0.001, 0.01, 0.1]
mlp_results = mlp_experiment(X_train, X_test, y_train, y_test, hidden_layers, learning_rates)
```

