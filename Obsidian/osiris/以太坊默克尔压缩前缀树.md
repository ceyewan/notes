**MPT 树**（Merkle Patricia Tree）是一种结合了  **Merkle Tree**（默克尔树）和  **Patricia Tree**（压缩前缀树）特性的树形数据结构。它的核心目标是高效地存储、验证和检索键值对数据。

* **Merkle Tree**：通过哈希逐层构建的树结构，用于验证数据的完整性。
* **Patricia Tree**：一种压缩前缀树，通过合并单子节点路径来优化存储空间。

MPT 树的设计旨在同时实现  **空间优化**、**数据验证**  和  **高效的键值存储**。

## 1 基础数据结构

### 1.1 Trie 字典树

**Trie** 是一种用于存储关联数组的树形结构，键按字符逐层分割路径。

* 键的公共前缀共享路径，节省空间。
* 查询时间复杂度与键长相关（O(L)）。

### 1.2 Merkle Tree 默克尔树

**Merkle Tree** 是一种通过哈希逐层构建的二叉树，用于高效验证数据完整性。

* 叶子节点存储数据哈希，非叶节点存储子节点哈希的拼接哈希。
* 根哈希唯一标识整棵树的状态。

### 1.3 Patricia Tree 压缩前缀树

**Patricia Tree** 是 Trie 的优化版本，通过合并单子节点路径来减少树深度。

* 通过路径压缩（合并单分支节点）降低空间复杂度。
* 支持更高效的插入和删除操作。

> 举个例子，用于直观的理解**合并单子节点路径**，左边是 Trie 中可能的结果，右边是 Patricia Tree 中对应的结构。
>
> ```
>       root                root
>      /    \              /    \
>    c       d          ca       do
>   /         \        /  \     /  \
>  a           o      t    r   g    d
> /  \        / \
> t    r     g   d
> ```

MPT 树的设计结合了 Trie、Merkle Tree 和 Patricia Tree 的需求，旨在同时实现 **空间优化**、**数据验证** 和 **高效的键值存储**。MPT 树的诞生背景正是为了解决这三者的局限性。

## 2 MPT 树核心结构

MPT 树包含四种节点类型：

1. **空节点（Null Node）**：表示空值或未初始化的节点。
2. **叶子节点（Leaf Node）**：存储键值对的最终存储单元。
3. **扩展节点（Extension Node）**：用于表示共享前缀的压缩表示。
4. **分支节点（Branch Node）**：包含 16 个子分支和一个可选的 Value 值。

MPT 树使用 **Hex-Prefix（HP）编码** 来压缩键的表示，消除冗余字符，优化路径存储。每个节点的哈希值由其子节点哈希生成，根哈希唯一标识整棵树的状态。这一特性使得 MPT 树能够高效地验证数据的完整性。

