## 1 术语概念

1. **电子机读旅行证件**：电子机读旅行证件（Machine Readable Travel Document, MRTD）是指任何包含机读功能的旅行证件，包括但不限于护照、签证、身份证等。电子护照是MRTD的一种特例。
2. **电子护照**：电子护照（e-Passport）是一种内置有非接触式智能卡芯片的旅行证件，该芯片通过RFID或NFC技术存储并传输持有者的个人信息和生物识别数据。
3. **机读区**：机读区（Machine Readable Zone, MRZ）是旅行证件上的一块专用区域，使用机器可读的格式打印个人信息，旨在提高自动化识别和验证的效率。
4. **电子护照阅读机**：电子护照阅读机（e-Passport Reader）是用于读取电子护照内芯片和机读区信息的专用设备，包含光学扫描、RFID/NFC读取、密码运算与验证等功能模块。

## 2 MRZ

MRZ 的内容根据护照类型和国际标准（ICAO Doc 9303）有所不同，最常见的两种格式是：

- **TD1:** 三行，每行30个字符，通常用于身份证件，例如身份证。
- **TD3:** 两行，每行44个字符，通常用于护照和签证。

这里我们说明更常见的 **TD3 格式**（两行，每行44个字符）。

护照资料页下方的两行称为 MRZ 码，每行 44 个字符（0-9，A-Z，<），如下图所示。

![image.png](https://ceyewan.oss-cn-beijing.aliyuncs.com/typora/20250118095523.png)

第一行：

| 位置   | 长度  | 字符     | 意义                |
| ---- | --- | ------ | ----------------- |
| 1    | 1   | 字母     | P 代表护照、V 代表签证     |
| 2    | 1   | 字母或填充符 | 护照类型              |
| 3-5  | 3   | 字母     | 签发国家或地区代码         |
| 6-44 | 39  | 字母或填充符 | 英文姓名，使用两个填充符对姓名分隔 |

第二行：

| 位置    | 长度  | 字符     | 意义                      |
| ----- | --- | ------ | ----------------------- |
| 1–9   | 9   | 字母或数字  | 护照号                     |
| 10    | 1   | 数字     | 护照号的校验位                 |
| 11–13 | 3   | 字母     | 国籍代码（ISO 3166-1标准）      |
| 14–19 | 6   | 数字     | 出生日期（YYMMDD）            |
| 20    | 1   | 字母     | 生日的校验位                  |
| 21    | 1   | 字母或填充符 | 性别（M、F 或填充符；表示男性，女性或不详） |
| 22–27 | 6   | 数字     | 护照有效期（YYMMDD）           |
| 28    | 1   | 数字     | 护照有效期的校验位               |
| 29–42 | 14  | 字母或数字  | 可选字段，可以是个人身份证号码或其他信息    |
| 43    | 1   | 数字     | 个人号码的校验位                |
| 44    | 1   | 数字     | 第二行1-10，14-20，22-43的验证位 |
校验位的计算逻辑：

```python
def compute_mrz_checksum(source): 
	s = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ" 
	w = [7, 3, 1] 
	c = 0 
	for i, char in enumerate(source): 
		if char == '<': continue # 跳过填充符 '<' 
		c += s.index(char) * w[i % 3] # 字符的索引乘以对应的权重 
	c %= 10 # 取模运算 
	return c
```