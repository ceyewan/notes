## 1 UML 图描述

**在线系统**涉及的用户表包含用户名、密码和角色信息，负责用户注册、登录和权限修改，支持基于角色的访问权限控制。

账户表包括账户地址和余额，主要用于获取账户余额、打包交易信息及交易上链。

由于交易的打包和签名上链被离线系统分开，交易表存储了账户、原始数据、数据哈希值、签名及交易状态，在打包和广播交易时使用。

日志表记录系统操作日志，用于审计。

**离线系统**的用户表功能与在线系统相同，但数据内容不同。

案件表包括案件名、状态、关联账户地址、私钥分片份额数和门限数，支持创建、更新和删除操作，创建案件时需生成门限签名密钥对，

安全芯片表用于映射内部编号 CID 和外壳序列号 SN，密钥对生成和签名时需要使用。

私钥分片映射表用于查找特定地址的私钥分片份额管理者及存储安全芯片。在密钥对生成、签名、变更或删除私钥分片时使用。

（麻烦你把表里面的案件表的 pub_key 改成 address）

## 2 在线存管提控系统实现的功能

===

系统采用 B/S（Browser/Server）架构，在服务端部署独立的 Geth 客户端，并依赖于离线签名系统进行交易签名。

交易流程为：

- 授权用户发起交易请求
- 服务器验证并准备交易数据
- 发送至离线系统进行签名
- 接收签名后执行交易并广播到以太坊网络
- 记录交易信息到数据库

<->

![image.png](https://ceyewan.oss-cn-beijing.aliyuncs.com/typora/20250116114334.png)

---
## 3 已有的开发成果

本项目已完成以下核心开发工作，充分验证了系统设计的可行性，并为后续开发奠定了坚实基础。

已实现在线系统的核心交易操作逻辑，能够高效处理用户输入的交易数据。具体流程包括：将用户输入的交易数据生成唯一的哈希值并发送至离线系统进行签名处理，待签名完成后返回结果并完成区块链上链操作。

![84f9489a93734df3a903d3b66b0b200b.jpg](https://ceyewan.oss-cn-beijing.aliyuncs.com/typora/84f9489a93734df3a903d3b66b0b200b.jpg)

---

离线系统已成功实现门限签名算法的核心逻辑，并开发了基于命令行的操作界面。通过密钥生成逻辑将私钥分片为三部分（支持多分片扩展），并使用门限值的分片完成签名操作。该设计从根本上保障了私钥的分布式管理与安全性，避免了单点故障。

![image.png](https://ceyewan.oss-cn-beijing.aliyuncs.com/typora/20250116104219.png)

---

客户端应用程序已支持多种操作系统，为系统提供了灵活的部署选择。客户端能够成功连接安全芯片，完成通信握手、数据交互以及功能验证。这为后续基于安全芯片的通信协议设计奠定了基础。

![6b19255a567a02aaa7e476aa47e5c886.jpg](https://ceyewan.oss-cn-beijing.aliyuncs.com/typora/6b19255a567a02aaa7e476aa47e5c886.jpg)

---
## 4 技术选型软硬件条件

| 类型      | 硬件要求                               | 软件要求                                  | 网络要求           | 说明                                |
| ------- | ---------------------------------- | ------------------------------------- | -------------- | --------------------------------- |
| 在线系统服务器 | 最低配置：双核 CPU、2GB 内存、30GB SSD        | Linux 操作系统；MySQL 数据库；Geth 客户端         | 需连接互联网         | 必须接入以太坊区块链网络                      |
| 离线系统服务器 | 最低配置：双核 CPU、2GB 内存、30GB SSD；部署 HSM | Linux 操作系统；MySQL 数据库；门限签名算法 Manager 端 | 内部局域网环境        | 配置 HSM，用于密钥存储和加密操作                |
| 客户端     | 主流 PC 硬件配置；至少部署 3 台设备              | 支持主流操作系统；支持主流浏览器；安装离线系统客户端软件          | 与服务器一致的内部局域网环境 | 设备需支持连接安全芯片；能够访问离线系统及 HSM 并运行相关软件 |
| 安全芯片    | 支持 PC/SC 标准驱动及 APDU 指令，至少 3 个设备    | 无需额外软件                                | 无网络连接需求        | 提供硬件级的密钥运算与数据加密功能                 |
| 移动存储介质  | 支持 USB 接口，最小存储容量 8GB               | 无需额外软件                                | 无网络连接需求        | 用于在线系统与离线系统之间的数据传输                |

---
## 5 项目难点

本项目以在线/离线系统分离架构为基础，采用门限签名算法和基于安全芯片与 HSM 的通信安全协议，工作量大、技术难点高，具有突出的安全性与创新性。

**系统架构设计**

- 在线系统与离线系统的分离设计，创新性地将私钥管理完全隔离在离线系统中，避免与外部网络直接交互，从而确保私钥的物理安全和逻辑安全。
- 实现在线/离线系统的高效协作需解决数据隔离、传输和一致性问题，同时需适配多种硬件设备，确保系统稳定性和兼容性。

**门限签名算法**

- 门限签名算法创新性地将密钥分片管理，与 Shamir 秘密共享等技术相结合，实现私钥的分布式存储与签名过程分散化，避免了私钥的集中存储风险。
- 算法实现涉及分布式计算、分片生成与重组的高效实现，需保证安全性与性能的平衡。同时，算法需与离线系统服务器深度集成，对计算资源和节点协作提出了高要求。
---
**通信协议开发**

- 设计了基于安全芯片和 HSM 的通信协议。协议通过安全芯片存储的数字证书与 HSM 的非对称加密握手生成不可预测的会话密钥，后续通信基于会话密钥加密。
- 需自主设计一套客户端与服务器之间的高效加密密钥交换协议，并确保协议的无漏洞实现。与硬件设备协同，加大了开发的难度。

**硬件安全特性**

- 离线系统结合了门限签名算法与硬件级安全设备，私钥分片分别存储在多个安全芯片中，安全芯片提供不可篡改性和物理防护，HSM 提供高性能硬件加密支持，实现了密钥生成、分片管理及签名的全流程硬件级加密。
- 实现安全芯片与 HSM 的硬件适配，以及多硬件设备协同工作需进行底层驱动开发与优化。

## 6 名词解释


| 术语   | 解释             |
| ---- | -------------- |
| 在线系统 | 负责与区块链交互，将交易信息 |
| 离线系统 |                |
| 案件   |                |
| 账户   |                |
| 钱包   |                |
| 公钥   |                |
| 私钥   |                |
| 私钥分片 |                |

