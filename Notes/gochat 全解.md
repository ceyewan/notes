## 1 API 层

这个部分，主要是为用户提供服务，基于 Restful API 的 HTTP 服务，是短连接的。

具体来说，首先，用户注册、登录、登出等，此外，这个部分还提供发送消息等服务。

为什么发送消息不是在 Connect 层，而是在这里的 API 层，是因为
1. **请求可靠性**：发送消息的 API 通常基于 HTTP/gRPC，有明确的请求-响应语义，可以确保消息一定被服务器接收并存储。如果采用长连接发送消息，一旦连接不稳定，可能会导致消息丢失，而 API 层可以通过重试策略（如幂等请求）提高可靠性。
2. **易于负载均衡**：API 发送消息可以利用 Nginx、API Gateway、Kubernetes 等成熟的 HTTP 负载均衡方案，使流量更加稳定。如果使用长连接发送消息，每个连接可能需要维护一个固定的服务器节点，不利于弹性扩展。
3. **安全性保障**：通过 API 层，服务器可以在每次请求时进行**身份验证（JWT、OAuth）**，并检查**用户权限**，防止非法发送消息。如果长连接直接发送消息，攻击者可能利用劫持的长连接不断发送垃圾消息，带来安全隐患。

