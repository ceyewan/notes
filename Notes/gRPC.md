## 1 RPC 核心概念与技术基础

在分布式系统中，不同的服务或组件运行在不同的机器上，它们之间需要进行通信和协作。RPC（Remote Procedure Call，远程过程调用）就是为了解决这个问题而诞生的。它允许一个程序调用另一个位于远程计算机上的程序，就像调用本地函数一样。

### 1.1 RPC 与本地函数调用的核心差异

- **网络延迟**： 本地函数调用几乎没有延迟，而 RPC 需要通过网络传输数据，因此会产生网络延迟。
- **序列化**：本地函数调用可以直接传递内存中的数据，而 RPC 需要将数据序列化成字节流才能在网络上传输，并在接收端解析。
- **可靠性**：本地函数调用通常是可靠的，而 RPC 需要考虑网络故障、服务器宕机等问题，因此需要提供重试、超时等机制来保证可靠性。

### 1.2 RPC 架构要素

- **客户端存根（Client Stub）**：负责将客户端的函数调用请求序列化成网络消息，并发送给服务端。
- **服务端骨架（Server Stub）**：负责接收客户端的请求，反序列化消息，调用相应的服务函数，并将结果序列化后返回给客户端。
- **序列化协议**：定义了数据如何序列化和反序列化，常见的序列化协议有 JSON、ProtoBuf 等。
- **传输协议**：定义了网络消息如何传输，常见的传输协议有 TCP、HTTP、gRPC（基于 HTTP/2）等。

### 1.3 应用场景

- **微服务**：微服务架构中，不同的服务之间通过 RPC 进行通信。
- **分布式计算**：分布式计算框架（如 Hadoop、Spark）使用 RPC 来协调不同节点之间的计算任务。
- **游戏服务器**：游戏服务器使用 RPC 来处理客户端的请求，并同步游戏状态。

### 1.4 Go 序列化

```go
// gob 序列化和反序列化，仅 go 支持
var buffer bytes.Buffer
encoder := gob.NewEncoder(&buffer)
encoder.Encode(data)
decoder := gob.NewDecoder(&buffer)
decoder.Decode(&data)
// json 序列化和反序列化
jsonData, _ := json.Marshal(data)
json.Unmarshal(jsonData, &data)
```

---

## 2 Go 原生 RPC 机制深度探索

### 2.1 标准库 net/rpc 全解析

Go 标准库 `net/rpc` 提供了一个基于 **TCP 或 HTTP** 的 RPC 框架，默认使用 **Gob** 进行序列化，也可以使用 JSON 来序列化。

Go 的 `net/rpc` 需要遵循特定的服务方法定义规范：
- 方法必须是 **导出（首字母大写）** 的。
- 方法必须有两个参数：
    1. **第一个参数是请求结构体（必须是指针类型）**
    2. **第二个参数是响应结构体（必须是指针类型）**
- 方法返回值必须是 `error`，用于标识调用成功或失败。

1. **标准库 net/rpc 全解析**
   - 接口定义规范与注册机制
   - 同步/异步调用模式对比
   - 自定义编解码器实现（Gob vs JSON）
   - 连接池管理与超时控制策略

2. **JSON-RPC 实战**
   - HTTP 协议承载 RPC 的实现
   - 跨语言通信案例（Python ↔ Go）
   - 负载均衡场景下的连接管理

---

## 3 gRPC 生态系统深度掌握
   - Protocol Buffers 语法精讲（v3 特性）
   - 四种服务方法实践：Unary/ServerStreaming/ClientStreaming/Bidirectional
   - 拦截器开发（认证/日志/监控）
   - Gateway 实现 RESTful 接口转换
   - 健康检查与负载均衡集成

---

## 4 RPC 底层协议栈拆解
1. **序列化协议性能之战**
   - Protobuf 编码原理与 varint 优化
   - FlatBuffers 零拷贝特性解析
   - Avro Schema 演进策略

2. **传输层关键技术**
   - HTTP/2 多路复用实现机制
   - QUIC 协议在 RPC 中的创新应用
   - 自定义私有协议设计实践

---

## 5 高可用架构设计模式
1. **服务治理三剑客**
   - 基于 Etcd/ZooKeeper 的服务发现
   - 负载均衡算法实现（P2C/一致性哈希）
   - 熔断器模式与弹性恢复策略（Hystrix-go）

---

## 6 分布式系统挑战赛
   - 分布式事务协调器开发
   - 最终一致性保障机制
   - 全局唯一 ID 生成器集群
